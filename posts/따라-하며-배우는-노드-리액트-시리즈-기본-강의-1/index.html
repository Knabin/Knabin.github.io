<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="ko"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js" /><meta name="author" content="구름" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="소개" /><meta property="og:description" content="소개" /><link rel="canonical" href="https://knabin.github.io/posts/%EB%94%B0%EB%9D%BC-%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%8B%9C%EB%A6%AC%EC%A6%88-%EA%B8%B0%EB%B3%B8-%EA%B0%95%EC%9D%98-1/" /><meta property="og:url" content="https://knabin.github.io/posts/%EB%94%B0%EB%9D%BC-%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%8B%9C%EB%A6%AC%EC%A6%88-%EA%B8%B0%EB%B3%B8-%EA%B0%95%EC%9D%98-1/" /><meta property="og:site_name" content="cloud nine" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-04T00:02:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@구름" /><meta name="google-site-verification" content="google89e4be86e025cf4d.html" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"구름"},"dateModified":"2022-04-04T00:02:00+09:00","datePublished":"2022-04-04T00:02:00+09:00","description":"소개","headline":"따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js","mainEntityOfPage":{"@type":"WebPage","@id":"https://knabin.github.io/posts/%EB%94%B0%EB%9D%BC-%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%8B%9C%EB%A6%AC%EC%A6%88-%EA%B8%B0%EB%B3%B8-%EA%B0%95%EC%9D%98-1/"},"url":"https://knabin.github.io/posts/%EB%94%B0%EB%9D%BC-%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%8B%9C%EB%A6%AC%EC%A6%88-%EA%B8%B0%EB%B3%B8-%EA%B0%95%EC%9D%98-1/"}</script><title>따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js | cloud nine</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="cloud nine"><meta name="application-name" content="cloud nine"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://raw.githubusercontent.com/knabin/knabin-images/master/common/avatar.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">cloud nine</a></div><div class="site-subtitle font-italic">늘 겸손하게 나아가는 사람</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>정보</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Knabin" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['knabinn97','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 300'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/knabin/knabin-images/master/common/nodejs.png" class="preview-img bg" alt="Preview Image" width="600" height="300" data-proofer-ignore><h1 data-toc-skip>따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/knabin">구름</a> </em></div><div class="d-flex"><div> <span> 게시 <em class="timeago" data-ts="1648998120" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-04 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2519 단어">읽는 시간 <em>13 분</em> </span></div></div></div><div class="post-content"><h1 id="소개">소개</h1><h2 id="보일러-플레이트란"><span class="mr-2">보일러 플레이트란?</span><a href="#보일러-플레이트란" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>웹사이트를 만들 때, 로그인, 회원가입 등등… 통상적으로 들어가는 기능들이 존재한다.<li>어떠한 프로젝트를 만들 때 0부터 직접 만드는 게 아니라, 자주 쓰이는 기능을 만들어서 어디든 <strong>재사용</strong>할 수 있게 한다.</ul><h1 id="nodejs와-expressjs-다운로드하기">Node.js와 Express.js 다운로드하기</h1><h2 id="nodejs"><span class="mr-2">Node.js</span><a href="#nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>기존 JavaScript는 브라우저에서만 동작했었다.<li>Node.js를 통해 Chrome이나 Internet Explorer에 국한된 게 아닌, 서버 사이드(server-side)에서도 쓸 수 있게 되었다.</ul><h2 id="expressjs"><span class="mr-2">Express.js</span><a href="#expressjs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>Node.js가 자동차 엔진이라면, 그 엔진을 가지고 자동차의 바퀴도 만들고, 브레이크도 만들고…<li>자동차를 만드는 것이 Express.js.<li>Node.js를 좀 더 쉽게 이용할 수 있는 프레임워크.</ul><h2 id="프로젝트-설정"><span class="mr-2">프로젝트 설정</span><a href="#프로젝트-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><code class="language-plaintext highlighter-rouge">package.json</code>에 express라고 추가되었음! 다운로드 할 때 –save라고 지정했는데… 이게 표시가 된다.<li>이 애플리케이션에서는 해당 기능을 사용하겠다, 라고 표시하는 것이다.<li><code class="language-plaintext highlighter-rouge">node_modules</code>라는 폴더 안에 다운 받을 dependency 라이브러리들이 모두 이 폴더에 있다. 여기는 수정할 일이 거의 없음.</ul><h1 id="mongodb-연동">MongoDB 연동</h1><ul><li>Mongoose: 몽고디비를 편하게 쓸 수 있는 툴</ul><blockquote class="prompt-tip"><div><p>다음 라인은 지워 주면 된다. MongoDB 6 버전 이상부터는 기본 값이어서 설정하지 않아도 된다.</p></div></blockquote><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">useNewUrlParser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">useUnifiedTopology</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">useCreateIndex</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">useFindAndModify</span><span class="p">:</span> <span class="kc">false</span>

<span class="o">&gt;&gt;</span> <span class="nx">MongoParseError</span><span class="p">:</span> <span class="nx">options</span> <span class="nx">usecreateindex</span><span class="p">,</span> <span class="nx">usefindandmodify</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">supported</span>
</pre></table></code></div></div><h1 id="mongodb-model--schema">MongoDB Model &amp; Schema</h1><ul><li>Model: Schema를 감싸 주는 역할<li>Schema: 상품에 관련된 글을 작성한다고 하면, 그 글을 작성한 사람이 누구인지, 작성할 때 포스트의 이름이 뭔지, 포스트 이름 타입이 뭐고, 최대 길이는 몇인지… 하나하나의 정보를 지정해 줄 수 있다.</ul><h1 id="bodyparser--postman--회원가입">BodyParser &amp; PostMan &amp; 회원가입</h1><ul><li>Client - 브라우저에서 회원가입을 하려고 하면… 이 클라단에서 이메일 비밀번호 작성해서 서버에 보냄<li>서버에서 받을 때 필요한 것들은 Body Parser를 이용한다. 예를 들면 이름, 이메일 등을 받을 수 있음.<li><code class="language-plaintext highlighter-rouge">npm install body-parser --save</code><li>현재로선 클라이언트를 만들어 둔 게 없으니 postman을 이용한다. <a href="https://www.postman.com/">&gt; postman</a></ul><h1 id="nodemon">NodeMon</h1><ul><li>원래대로라면 이 Node 서버를 내리고 다시 켜야 반영이 되는데, NodeMon 라이브러리를 이용하면 내리고 올리지 않아도 소스 변화를 감지해서 반영시켜 준다.<li><code class="language-plaintext highlighter-rouge">npm install nodemon --save</code></ul><h1 id="환경별-uri-설정">환경별 URI 설정</h1><ul><li>환경별 config를 추가하여 dev, production이 각각 다른 DB를 바라보게 한다.<li>또한 MongoDB URI가 외부로 노출되는 일이 없게 한다. (Git 등…)</ul><h1 id="bcrypt">Bcrypt</h1><ul><li>Bcrypt를 이용하여 패스워드를 암호화한다.<li><code class="language-plaintext highlighter-rouge">npm install --save bcrypt</code></ul><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">// sava 하기 전, function을 실행함</span>
<span class="nx">userSchema</span><span class="p">.</span><span class="nx">pre</span><span class="p">(</span><span class="dl">'</span><span class="s1">save</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">isModified</span><span class="p">(</span><span class="dl">'</span><span class="s1">password</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// 비밀번호를 암호화한다.</span>
        <span class="c1">// salt를 이용해서 비밀번호를 암호화하며, 이 salt를 생성해야 한다.</span>
        <span class="c1">// saltRounds는 salt가 몇 글자인지를 나타낸다.</span>
        <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">genSalt</span><span class="p">(</span><span class="nx">saltRounds</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">salt</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

            <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="nx">salt</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
                <span class="nx">user</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="nx">hash</span>
                <span class="nx">next</span><span class="p">()</span>
            <span class="p">})</span>
        <span class="p">})</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 비밀번호가 아니라 다른 정보를 변경한다면 넘겨 준다.</span>
        <span class="nx">next</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></table></code></div></div><ul><li>pre 함수는 매개변수로 입력한 ‘save’ 함수가 실행되기 전, function을 실행하게끔 한다.<li>next()는 그 다음 함수로 넘어가는 함수.</ul><p><img data-src="https://raw.githubusercontent.com/knabin/knabin-images/master/posts/220404/1.png" alt="1" data-proofer-ignore></p><h1 id="로그인-기능">로그인 기능</h1><h2 id="이메일-유효성-검사-password-비교"><span class="mr-2">이메일 유효성 검사, password 비교</span><a href="#이메일-유효성-검사-password-비교" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 요청된 이메일을 데이터베이스에 있는지 찾는다.</span>
    <span class="nx">User</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
                <span class="na">loginSuccess</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">제공된 이메일에 해당하는 유저가 없습니다.</span><span class="dl">"</span>
            <span class="p">})</span>
        <span class="p">}</span>

        <span class="c1">// 요청된 이메일이 데이터베이스에 있다면, 비밀번호가 맞는지 확인한다.</span>
        <span class="nx">user</span><span class="p">.</span><span class="nx">comparePassword</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">isMatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isMatch</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span> <span class="p">({</span> <span class="na">loginSuccess</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">비밀번호가 틀렸습니다.</span><span class="dl">"</span><span class="p">})</span>
        
            <span class="c1">// 비밀번호까지 맞다면, 토큰을 생성한다.</span>
            <span class="nx">user</span><span class="p">.</span><span class="nx">generateToken</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="c1">// 후술</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">})</span>
</pre></table></code></div></div><ul><li>plain text로 들어온 입력을 암호화하여 비교해 준다. 이때, <code class="language-plaintext highlighter-rouge">bcrypt.compare()</code>를 사용한다.</ul><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nx">userSchema</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">comparePassword</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">plainPassword</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// plainPassword 1234567    암호화된 비밀번호 $2b$10...</span>
    <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">plainPassword</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">isMatch</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">isMatch</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="token-생성"><span class="mr-2">Token 생성</span><a href="#token-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>로그인이 성공하면 토큰을 생성한다.<li>jsonwebtoken 라이브러리를 사용한다. &gt; <a href="https://www.npmjs.com/package/jsonwebtoken">jsonwebtoken</a><li><p>json web token library <code class="language-plaintext highlighter-rouge">npm install jsonwebtoken --save</code></p><li><code class="language-plaintext highlighter-rouge">jwt.sign()</code>을 이용하여 user._id를 포함한 토큰을 생성한다.<li>이 토큰을 파싱하여 어떤 유저인지(<code class="language-plaintext highlighter-rouge">user._id</code>)를 파악할 수 있다.</ul><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nx">userSchema</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">generateToken</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// jsonwebtoken을 이용하여 token을 생성한다.</span>
    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="c1">// user._id + 'secretToken' = token</span>
    <span class="c1">// 'secretToken' -&gt; user._id</span>
    <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">.</span><span class="nx">toHexString</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">secretToken</span><span class="dl">'</span><span class="p">)</span>

    <span class="nx">user</span><span class="p">.</span><span class="nx">token</span> <span class="o">=</span> <span class="nx">token</span>
    <span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></table></code></div></div><ul><li>만들어진 토큰을 쿠키 또는 로컬 스토리지에 저장한다. 각각의 장단점이 존재하기 때문에 어디에 저장할지 선택해야 한다. 이번에는 쿠키에 저장해 본다.<li>cookie-parser라는 라이브러리를 사용한다.<li><code class="language-plaintext highlighter-rouge">npm install cookie-parser --save</code></ul><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 요청된 이메일을 데이터베이스에 있는지 찾는다.</span>
    <span class="nx">User</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
                <span class="na">loginSuccess</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">제공된 이메일에 해당하는 유저가 없습니다.</span><span class="dl">"</span>
            <span class="p">})</span>
        <span class="p">}</span>

        <span class="c1">// 요청된 이메일이 데이터베이스에 있다면, 비밀번호가 맞는지 확인한다.</span>
        <span class="nx">user</span><span class="p">.</span><span class="nx">comparePassword</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">isMatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isMatch</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span> <span class="p">({</span> <span class="na">loginSuccess</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">비밀번호가 틀렸습니다.</span><span class="dl">"</span><span class="p">})</span>
        
            <span class="c1">// 비밀번호까지 맞다면, 토큰을 생성한다.</span>
            <span class="nx">user</span><span class="p">.</span><span class="nx">generateToken</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
            
            <span class="c1">// 토큰을 저장한다. 어디에? 쿠키, 로컬 스토리지...</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="dl">"</span><span class="s2">x_auth</span><span class="dl">"</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">token</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">loginSuccess</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">userId</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="p">})</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">})</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/knabin/knabin-images/master/posts/220404/2.png" alt="2" data-proofer-ignore></p><h1 id="auth-기능">Auth 기능</h1><h2 id="auth가-필요한-이유"><span class="mr-2">Auth가 필요한 이유</span><a href="#auth가-필요한-이유" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>페이지마다 권한이 다를 수 있다. 글 쓰기 등 어떠한 페이지는 로그인이 되어 있어야 하고, 관리자만 접근할 수 있는 페이지 또한 존재할 수 있다.<li>따라서 페이지 이동할 때마다 로그인이 되어 있는지, 관리자 유저인지 등을 체크해야 한다.<li>글을 쓰거나 지울 때, 권한이 있는지 체크되어야 한다.</ul><h2 id="대략적인-과정"><span class="mr-2">대략적인 과정</span><a href="#대략적인-과정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>서버에서 쿠키에 저장된 Token을 가져온다.<li>Encoded Token을 Decode하면 <code class="language-plaintext highlighter-rouge">user._id</code>가 나온다.<li>이 id가 DB에 있다면 이 토큰은 유효하다고 서버에서 판단한다.</ul><h2 id="구현"><span class="mr-2">구현</span><a href="#구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>middleware: end point에서 req를 받은 다음, callback function 호출하기 전에 처리해 준다.</ul><p><code class="language-plaintext highlighter-rouge">middleware/auth.js</code> 생성</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">auth</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 각종 인증 처리를 진행한다.</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">auth</span> <span class="p">};</span>
</pre></table></code></div></div><h3 id="authjs"><span class="mr-2">auth.js</span><a href="#authjs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../models/User</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">auth</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 각종 인증 처리를 진행한다.</span>
    <span class="c1">// 클라이언트 쿠키에서 토큰을 가져온다.</span>
    <span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">x_auth</span><span class="p">;</span>

    <span class="c1">// 토큰을 복호화한 후, 유저를 찾는다.</span>
    <span class="nx">User</span><span class="p">.</span><span class="nx">findByToken</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">isAuth</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">error</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>

        <span class="nx">req</span><span class="p">.</span><span class="nx">token</span> <span class="o">=</span> <span class="nx">token</span><span class="p">;</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
        <span class="nx">next</span><span class="p">()</span>  <span class="c1">// next가 없으면 middleware에 갇히니 주의한다!</span>
    <span class="p">})</span>

    <span class="c1">// 유저가 있으면 인증 OK</span>

    <span class="c1">// 유저가 없으면 인증 NO!</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">auth</span> <span class="p">};</span>
</pre></table></code></div></div><h3 id="userjs"><span class="mr-2">User.js</span><a href="#userjs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nx">userSchema</span><span class="p">.</span><span class="nx">statics</span><span class="p">.</span><span class="nx">findByToken</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="c1">// 토큰을 decode 한다.</span>
    <span class="c1">// user._id + '' = token</span>
    <span class="nx">jwt</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="dl">'</span><span class="s1">secretToken</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">decoded</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 유저 아이디를 이용하여 유저를 찾은 후, </span>
        <span class="c1">// 클라이언트에서 가져온 token과 DB에 보관된 token이 일치하는지 확인한다.</span>
        <span class="nx">user</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span> <span class="p">:</span> <span class="nx">decoded</span><span class="p">,</span> <span class="dl">"</span><span class="s2">token</span><span class="dl">"</span><span class="p">:</span> <span class="nx">token</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
            <span class="nx">cd</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="indexjs"><span class="mr-2">index.js</span><a href="#indexjs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">auth</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./middleware/auth</span><span class="dl">'</span><span class="p">)</span>

<span class="c1">// ...</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/users/auth</span><span class="dl">'</span><span class="p">,</span> <span class="nx">auth</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 여기까지 미들웨어를 통과해 왔다 =&gt; Authentication이 true라는 뜻</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">_id</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
        <span class="na">isAdmin</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">?</span> <span class="kc">false</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">isAuth</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">email</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
        <span class="na">lastName</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
        <span class="na">role</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">image</span>
    <span class="p">})</span>
<span class="p">})</span>
</pre></table></code></div></div><h1 id="로그아웃-기능">로그아웃 기능</h1><ul><li>로그아웃 Route를 만들어서, 로그아웃 하려는 유저를 DB에서 찾아서 그 유저의 토큰을 지워 준다.<li>Auth를 구현할 때 클라이언트단에 있는 토큰과 DB에 있는 토큰을 비교하는데, DB에 있는 토큰을 지워 버리면 토큰 비교는 항상 실패하게 될 것이다. 따라서 로그아웃 시 DB의 토큰을 지우면 된다.</ul><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/users/logout</span><span class="dl">'</span><span class="p">,</span> <span class="nx">auth</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">User</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">token</span><span class="p">:</span> <span class="dl">""</span><span class="p">},</span>
        <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">err</span><span class="p">});</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">success</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">})</span>
        <span class="p">})</span>
<span class="p">})</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/knabin/knabin-images/master/posts/220404/3.png" alt="3" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/knabin/knabin-images/master/posts/220404/4.png" alt="4" data-proofer-ignore></p><ul><li>로그아웃 성공 후, DB의 토큰이 사라져 있다.</ul><p><img data-src="https://raw.githubusercontent.com/knabin/knabin-images/master/posts/220404/5.png" alt="5" data-proofer-ignore></p><hr /><p>해당 포스트는 다음의 강의를 수강하며 개인 기록용으로 메모하였습니다. 양질의 지식을 제공해 주신 <strong>John Ahn</strong> 님께 감사드립니다.</p><p><a href="https://inf.run/69Aa">따라하며 배우는 노드, 리액트 시리즈 - 기본 강의</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/javascript/'>JavaScript</a>, <a href='/categories/%EB%94%B0%EB%9D%BC-%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%8B%9C%EB%A6%AC%EC%A6%88/'>따라 하며 배우는 노드 리액트 시리즈</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/javascript/" class="post-tag no-text-decoration" >JavaScript</a> <a href="/tags/node-js/" class="post-tag no-text-decoration" >Node.js</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js - cloud nine&amp;url=https://knabin.github.io/posts/%EB%94%B0%EB%9D%BC-%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%8B%9C%EB%A6%AC%EC%A6%88-%EA%B8%B0%EB%B3%B8-%EA%B0%95%EC%9D%98-1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js - cloud nine&amp;u=https://knabin.github.io/posts/%EB%94%B0%EB%9D%BC-%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%8B%9C%EB%A6%AC%EC%A6%88-%EA%B8%B0%EB%B3%B8-%EA%B0%95%EC%9D%98-1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://knabin.github.io/posts/%EB%94%B0%EB%9D%BC-%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%8B%9C%EB%A6%AC%EC%A6%88-%EA%B8%B0%EB%B3%B8-%EA%B0%95%EC%9D%98-1/&amp;text=따라 하며 배우는 노드, 리액트 시리즈 - 기본 강의 1. Node.js - cloud nine" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">최근 업데이트</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/yaml-and-yaml-cpp/">yaml & yaml-cpp</a></ul></div><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/game-develop/">Game Develop</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/node-js/">Node.js</a> <a class="post-tag" href="/tags/yaml/">YAML</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/MMORPG-%EA%B2%8C%EC%9E%84-%EA%B0%9C%EB%B0%9C-%EC%8B%9C%EB%A6%AC%EC%A6%88-Part4-1/"><div class="card-body"> <em class="timeago small" data-ts="1653208560" > 2022-05-22 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>C++과 언리얼로 만드는 MMORPG 게임 개발 시리즈 Part.4 게임 서버 - 1. OT</h3><div class="text-muted small"><p> OT 개요 게임 서버는 여러 플레이어가 같이 할 수 있게 해 주는 관제자. 그러나 관련 자료가 거의 없다… 그만큼 게임 서버 개발자에 대한 가치와 희귀성이 증가할 수밖에 없는 상황. 서버 OT 서버 개론 서버란? 다른 컴퓨터에서 연결이 가능하도록 항상 대기 중인 상태로 실행하는 프로그램. (물론 서버 PC 자체를 서버라고 볼 ...</p></div></div></a></div><div class="card"> <a href="/posts/yaml-and-yaml-cpp/"><div class="card-body"> <em class="timeago small" data-ts="1650403260" > 2022-04-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>yaml & yaml-cpp</h3><div class="text-muted small"><p> YAML YAML(Yet Another Markup Language) .yml, .yaml 기본 문법 들여쓰기 (indent) 2칸(권장) 또는 4칸 1 2 3 4 5 6 person: name: Nabin Kim job: developer skills: - docker - kubern...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="이전 글"><p>-</p></span> <a href="/posts/yaml-and-yaml-cpp/" class="btn btn-outline-primary" prompt="다음 글"><p>yaml & yaml-cpp</p></a></div><script src="https://utteranc.es/client.js" repo="Knabin/knabin.github.io" issue-term="url" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/knabin">구름</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/game-develop/">Game Develop</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/node-js/">Node.js</a> <a class="post-tag" href="/tags/yaml/">YAML</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=221371935"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '221371935'); }); </script>
